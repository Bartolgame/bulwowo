<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulwowo - Ogłoszenia</title>
    <style>
        /* Dodajemy styl zgodny z poprzednią wersją */
    </style>
</head>
<body>

<div class="header">
    <h1>Bulwowo Ogłoszenia</h1>
</div>

<div class="category-filter">
    <button onclick="filterAds('Motoryzacja')">Motoryzacja</button>
    <button onclick="filterAds('Nieruchomości')">Nieruchomości</button>
    <button onclick="filterAds('Elektronika')">Elektronika</button>
    <button onclick="filterAds('Praca')">Praca</button>
</div>

<button class="add-ad-button" onclick="toggleAdForm()">Dodaj ogłoszenie</button>

<div class="ad-form" id="ad-form" style="display: none;">
    <h2>Dodaj Ogłoszenie</h2>
    <select id="category">
        <option value="Motoryzacja">Motoryzacja</option>
        <option value="Nieruchomości">Nieruchomości</option>
        <option value="Elektronika">Elektronika</option>
        <option value="Praca">Praca</option>
    </select>
    <input type="text" id="ad-title" placeholder="Tytuł ogłoszenia" required>
    <textarea id="ad-description" placeholder="Opis ogłoszenia" rows="5" required></textarea>
    <input type="file" id="ad-image" accept="image/*">
    <button onclick="submitAd()">Dodaj Ogłoszenie</button>
</div>

<div class="ad-container" id="ad-container"></div>

<script>
    const currentUser = localStorage.getItem('loggedUser');
    const ads = JSON.parse(localStorage.getItem('ads')) || [];

    function toggleAdForm() {
        const form = document.getElementById('ad-form');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    function submitAd() {
        const title = document.getElementById('ad-title').value;
        const description = document.getElementById('ad-description').value;
        const category = document.getElementById('category').value;
        const image = document.getElementById('ad-image').files[0];

        if (title && description) {
            const ad = {
                id: Date.now(),
                title: title,
                description: description,
                category: category,
                image: image ? URL.createObjectURL(image) : null,
                user: currentUser
            };

            ads.push(ad);
            localStorage.setItem('ads', JSON.stringify(ads));
            displayAds();
            toggleAdForm();
        }
    }

    function filterAds(category) {
        const filteredAds = ads.filter(ad => ad.category === category);
        displayAds(filteredAds);
    }

    function displayAds(filteredAds = ads) {
        const container = document.getElementById('ad-container');
        container.innerHTML = '';
        
        filteredAds.forEach(ad => {
            const adElement = document.createElement('div');
            adElement.classList.add('ad-item');
            adElement.innerHTML = `
                <h3>${ad.title}</h3>
                <p>${ad.description}</p>
                ${ad.image ? `<img src="${ad.image}" alt="Zdjęcie ogłoszenia">` : ''}
                <div class="ad-buttons">
                    ${ad.user === currentUser ? `<button onclick="editAd(${ad.id})">Edytuj</button><button onclick="deleteAd(${ad.id})">Usuń</button>` : ''}
                </div>
            `;
            container.appendChild(adElement);
        });
    }

    function editAd(id) {
        const ad = ads.find(ad => ad.id === id);
        if (ad.user === currentUser) {
            document.getElementById('ad-title').value = ad.title;
            document.getElementById('ad-description').value = ad.description;
            document.getElementById('category').value = ad.category;
            toggleAdForm();
            deleteAd(id); // Usuwamy ogłoszenie przed edytowaniem
        }
    }

    function deleteAd(id) {
        const adIndex = ads.findIndex(ad => ad.id === id);
        if (adIndex !== -1) {
            ads.splice(adIndex, 1);
            localStorage.setItem('ads', JSON.stringify(ads));
            displayAds();
        }
    }

    // Wyświetlamy ogłoszenia przy ładowaniu strony
    displayAds();
</script>

</body>
</html>
